/*!
  * vue-dataAc v2.0.8
  * (c) 2020 adminV
  * @license MIT
  */
var t,e;t=this,e=function(){"use strict";var t,e={storeVer:"2.0.8",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",storeVueErr:"ACVUERR",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrQuery:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openVueErr:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,maxComponentLoadTime:1e3,openXhrTimeOut:!0,maxRequestTime:1e4,customXhrErrCode:"",selector:"input",ignoreInputType:["password","file"],classTag:"",maxHelpfulCount:5,imageUrl:"http://data.isjs.cn/lib/image/ac.png",postUrl:"http://data.isjs.cn/logStash/push",openReducer:!1,sizeLimit:20,cacheEventStorage:"ac_cache_data",manualReport:!1};function o(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function r(t){for(var e in t)return!1;return!0}function i(t){var e=t.attributes?t.attributes.length:0,o={};if(e>0)for(var r=0;r<e;r++){var i=t.attributes[r];o[i.nodeName]=i.nodeValue.replace(/"/gim,"'")}return o}function a(t,e,o,r){if(t.useStorage)window.localStorage.setItem(e,o);else{r||(r=t.maxDays);var i=new Date;i.setTime(i.getTime()+24*r*60*6e4),document.cookie=e+"="+encodeURIComponent(o)+";expires="+i.toUTCString()+";path=/"}}function n(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);var o=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return o&&o.length>1?decodeURIComponent(o[2]):null}function s(){var t=new Date;return{timeStr:t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),timeStamp:t.getTime()}}function p(t){var e=t.toString(),o=t.stack?t.stack.replace(/\n/gi,"").replace(/\bat\b/gi,"@").replace(/\?[^:]+/gi,"").replace(/^\s*|\s*$/g,"").split("@").slice(0,5).join("&&"):"";return o.indexOf(e)<0&&(o=e+"@"+o),o}var c=function(i,s){void 0===i&&(i={}),void 0===s&&(s={});var p=function(t,e){for(var o={},r=Object.keys(e),i=0;i<r.length;i++)o[r[i]]=void 0!==t[r[i]]?t[r[i]]:e[r[i]];return o}(i,e);if(function(t){var e=!0;if(r(t))return!1;if(["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","storeCustom","storeSourceErr","storePrmseErr","storeCompErr","storeVueErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrQuery","openXhrHock","openPerformance","openPage","openVueErr","openSourceErr","openPromiseErr","openComponent","openXhrTimeOut"].map((function(r){o(t[r])&&(e=!1)})),t.useImgSend){if(o(t.imageUrl))return!1}else if(o(t.postUrl))return!1;return(!t.openInput||!o(t.selector))&&(!t.useStorage||void 0!==window.localStorage)&&e}(p)){this.installed=!0,this._options=p,this._vue_=s,t=this,this._uuid=n(this._options,this._options.userSha),o(this._uuid)&&(this._uuid=function(t,e){void 0===t&&(t=16),void 0===e&&(e=16);for(var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[],i=0;i<t;i++)r[i]=o[0|Math.random()*e];return r.join("")}(),a(this._options,this._options.userSha,this._uuid));var c=n(this._options,this._options.cacheEventStorage);this._acData=o(c)?[]:JSON.parse(c),this._proxyXhrObj={},this._inputCacheData={},this._componentsTime={},this._lastRouterStr="",this._userToken="",this._pageInTime=0,this._componentLoadCount=0,this._componentTimeCount=0,this._init()}else this.installed=!1};return c.prototype._init=function(){this._options.openVueErr&&this._initVueErrAc(),this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openClick&&this._initClickAc(),this._options.openXhrQuery&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance()},c.prototype._mixinInputEvent=function(t){for(var e=this._options,o=e.ignoreInputType,r=e.selector,i=document.querySelectorAll(r),a=0,n=i.length;a<n;a++){var s=i[a];s.type&&o.indexOf(s.type.toLowerCase())<0&&(s.removeEventListener("input",this._formatInputEvent),s.removeEventListener("blur",this._formatBlurEvent),s.addEventListener("input",this._formatInputEvent),s.addEventListener("blur",this._formatBlurEvent))}},c.prototype._mixinComponentsPerformanceStart=function(t){var e=t.$vnode;void 0===e&&(e={}),o(e.tag)||(t.$_vueAc_bc_time=s().timeStamp,t.$vueDataAc._componentTimeCount++)},c.prototype._mixinComponentsPerformanceEnd=function(t){var e=t.$_vueAc_bc_time,i=t.$vnode;void 0===i&&(i={});var a=i.tag;if(!o(e)&&!o(a)){var n=s().timeStamp,p=parseInt(n-e);p>=t.$vueDataAc._options.maxComponentLoadTime&&(o(t.$vueDataAc._componentsTime[a])&&(t.$vueDataAc._componentsTime[a]=[]),t.$vueDataAc._componentsTime[a].push(p)),0==--t.$vueDataAc._componentTimeCount&&!r(t.$vueDataAc._componentsTime)&&(this._setAcData(t.$vueDataAc._options.storeCompErr,{componentsTimes:t.$vueDataAc._componentsTime}),t.$vueDataAc._componentsTime={})}},c.prototype._formatInputEvent=function(e){var a=window.event||e,n=a.srcElement?a.srcElement:a.target,p=n.id,c=n.className,u=n.value,m=n.innerText,h=i(n),l=u||m,_=s().timeStamp,d="";try{d=JSON.stringify(h)}catch(e){d=p+"-"+c}var v=t._inputCacheData[d];v=o(v)||r(v)?{value:"0:"+l,timeStamp:_}:{value:v.value+","+parseInt(_-v.timeStamp)+":"+l,timeStamp:_},t._inputCacheData[d]=v},c.prototype._formatBlurEvent=function(e){var r=window.event||e,a=r.srcElement?r.srcElement:r.target,n=a.id,s=a.className,p=i(a),c="";try{c=JSON.stringify(p)}catch(e){c=n+"-"+s}var u=t._inputCacheData[c];o(u)||(t._inputCacheData[c]=null,t._setAcData(t._options.storeInput,{eId:n,className:s,val:u.value,attrs:p}))},c.prototype._mixinRouterWatch=function(t,e,i){void 0===t&&(t={}),void 0===e&&(e={});var s="",p={},c="",u={},m="";if(i){if(s=t.fullPath||t.path||t.name,p=r(t.params)?t.query:t.params,c=e.fullPath||e.path||e.name,u=r(e.params)?e.query:e.params,(m=this._lastRouterStr)===s+"-"+JSON.stringify(p))return}else m=n(this._options,"_vueac_"+this._options.storePage)||"",s=window.location.href,p={search:window.location.search},c=m,u={};i&&(o(s)||o(c))||(this._lastRouterStr=s+"-"+JSON.stringify(p),a(this._options,"_vueac_"+this._options.storePage,s+"-"+JSON.stringify(p)),this._setAcData(this._options.storePage,{toPath:s,toParams:p,fromPath:c,formParams:u}),this._options.openReducer&&!this._options.manualReport&&this.postAcData&&this.postAcData())},c.prototype._initClickAc=function(){var t=this;document.addEventListener("click",(function(e){var r=window.event||e,a=function t(e,r,i){if(void 0===i&&(i=0),Object.prototype.toString.call(e)===Object.prototype.toString.call(document))return null;var a=e&&e.parentNode,n=e.className;void 0===n&&(n="");var s=e.id,p=r.classTag,c=r.maxHelpfulCount;return o(p)?i>c?null:o(n)&&o(s)?o(a)?null:t(a,r,++i):e:n.indexOf(p)<0?o(a)||i>c?null:t(a,r,++i):e}(r.srcElement?r.srcElement:r.target,t._options);if(!o(a)){var n=a.className,s=a.id,p=a.value,c=a.innerText,u=i(a);t._setAcData(t._options.storeClick,{eId:s,className:n,val:(p||c).substr(0,20),attrs:u})}}))},c.prototype._initXhrErrAc=function(){var e=XMLHttpRequest.prototype.open,o=XMLHttpRequest.prototype.send,r=XMLHttpRequest.onreadystatechange;this._proxyXhrObj={open:function(){return this._ac_method=(arguments[0]||[])[0],e&&e.apply(this,arguments)},send:function(){return this._ac_send_time=s().timeStamp,this._ac_post_data=(arguments[0]||[])[0]||"",this.addEventListener("error",(function(e){t._formatXhrErrorData(e.target)})),this.onreadystatechange=function(e){t._formatXhrErrorData(e.target),r&&r.apply(this,arguments)},o&&o.apply(this,arguments)}},XMLHttpRequest.prototype.open=this._proxyXhrObj.open,XMLHttpRequest.prototype.send=this._proxyXhrObj.send},c.prototype._formatXhrErrorData=function(e){var r=e,i=r.method,a=r.send_time;void 0===a&&(a=0);var n=r.post_data;void 0===n&&(n={});var p=r.readyState;if(4===p){var c=r.status,u=r.statusText,m=r.response,h=r.responseURL,l=s().timeStamp,_=l-(a||l),d=t._options,v=d.openXhrTimeOut,f=d.storeReqErr,g=d.customXhrErrCode,T=d.openXhrQuery,E=_>t._options.maxRequestTime,D=!(c>=200&&c<208)&&0!==c&&302!==c,S=!o(g)&&""+(m&&m.code)===g,y=!o(h)&&h===t._options.postUrl;(v&&E||D||S)&&!y&&t._setAcData(f,{responseURL:h,method:i,isHttpErr:D,isCustomErr:S,readyState:p,status:c,statusText:u,requestTime:_,response:(""+m).substr(0,100),query:T?n:""})}},c.prototype._initPerformance=function(){if(window.performance){var t=(window.performance||{}).timing;if(!o(t)){var e={WT:t.responseStart-t.navigationStart,TCP:t.connectEnd-t.connectStart,ONL:t.loadEventEnd-t.loadEventStart,ALLRT:t.responseEnd-t.requestStart,TTFB:t.responseStart-t.navigationStart,DNS:t.domainLookupEnd-t.domainLookupStart};this._setAcData(this._options.storeTiming,e)}}},c.prototype._initVueErrAc=function(){var t=this;this._vue_&&this._vue_.config&&(this._vue_.config.errorHandler=function(e,o,r){void 0===e&&(e={});var i=o._isVue?o.$options&&o.$options.name||o.$options&&o.$options._componentTag:o.name,a=o._isVue&&o.$options&&o.$options.__file?o.$options&&o.$options.__file:"",n=o.$options&&o.$options.propsData;t._setAcData(t._options.storeVueErr,{componentName:i,fileName:a,propsData:n,info:r,msg:e.message||"",stack:p(e)})})},c.prototype._initCodeErrAc=function(){var t=arguments,e=this;window.onerror=function(r,i,a,n,s){if(o(i)&&"Script error."===r)return!1;var p={msg:r,line:a,col:n};p.col=n||window.event&&window.event.errorCharacter||0,setTimeout((function(){if(s&&s.stack)p.err=s.stack.toString();else if(t.callee){for(var o=[],r=t.callee.caller,i=3;r&&--i>0&&(o.push(r.toString()),r!==r.caller);)r=r.caller;o=o.join(","),p.err=o}else p.err="script err";e._setAcData(e._options.storeCodeErr,p)}),0)}},c.prototype._initSourceErrAc=function(){var t=this;window.addEventListener("error",(function(e){if("[object Event]"===[].toString.call(e,e)){var r=e.target||e.srcElement||e.originalTarget||{},i=r.href,a=r.src,n=r.currentSrc,s=r.localName,p=r.tagName||s,c=r.outerHTML,u=i||a;if("IMG"===p&&!o(r.onerror))return!1;c&&c.length>200&&(c=c.slice(0,200)),t._setAcData(t._options.storeSourceErr,{tagName:p,outerHTML:c,resourceUri:u,currentSrc:n})}}))},c.prototype._initPromiseErrAc=function(){var t=this;window.addEventListener("unhandledrejection",(function(e){t._setAcData(t._options.storePrmseErr,{reason:e.reason||"unknown"}),e.preventDefault()}))},c.prototype._setAcData=function(t,e){var o=this,r={uuid:this._uuid,t:this._userToken};switch(t){case this._options.storePage:var i=e.toPath,n=e.toParams,p=e.fromPath,c=e.formParams,u=this._pageInTime,m=s().timeStamp;this._pageInTime=m,r.acData={type:this._options.storePage,sTme:m,fromPath:p,formParams:c,toPath:i,toParams:n,inTime:u,outTime:m};break;case this._options.storeInput:var h=e.eId,l=e.className,_=e.val,d=e.attrs;r.acData={type:this._options.storeInput,path:window.location.href,sTme:s().timeStamp,eId:h,className:l,val:_,attrs:d};break;case this._options.storeClick:var v=e.eId,f=e.className,g=e.val,T=e.attrs;r.acData={type:this._options.storeClick,path:window.location.href,sTme:s().timeStamp,eId:v,className:f,val:g,attrs:T};break;case this._options.storeReqErr:var E=e.responseURL,D=e.method,S=e.isHttpErr,y=e.isCustomErr,A=e.readyState,C=e.status,$=e.statusText,w=e.requestTime,P=e.response,R=e.query;r.acData={type:this._options.storeReqErr,path:window.location.href,sTme:s().timeStamp,errSubType:S?"http":y?"custom":"time",responseURL:E,method:D,readyState:A,status:C,statusText:$,requestTime:w,response:P,query:R};break;case this._options.storeVueErr:var x=e.componentName,k=e.fileName,L=e.propsData,I=e.info,N=e.msg,b=e.stack;r.acData={type:this._options.storeVueErr,path:window.location.href,sTme:s().timeStamp,componentName:x,fileName:k,propsData:L,info:I,msg:N,err:b};break;case this._options.storeCodeErr:var O=e.msg,X=e.line,q=e.col,U=e.err;r.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:s().timeStamp,msg:O,line:X,col:q,err:U};break;case this._options.storeSourceErr:var M=e.tagName,H=e.outerHTML,j=e.resourceUri,V=e.currentSrc;r.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:s().timeStamp,fileName:V,resourceUri:j,tagName:M,outerHTML:H};break;case this._options.storePrmseErr:var J=e.reason;r.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:s().timeStamp,reason:J};break;case this._options.storeCustom:var B=e.cusKey,W=e.cusVal;r.acData={type:this._options.storeCustom,path:window.location.href,sTme:s().timeStamp,cusKey:B,cusVal:W};break;case this._options.storeTiming:var F=e.WT,G=e.TCP,K=e.ONL,Q=e.ALLRT,z=e.TTFB,Y=e.DNS;r.acData={type:this._options.storeTiming,path:window.location.href,sTme:s().timeStamp,WT:F,TCP:G,ONL:K,ALLRT:Q,TTFB:z,DNS:Y};break;case this._options.storeCompErr:var Z=e.componentsTimes;r.acData={type:this._options.storeCompErr,path:window.location.href,sTme:s().timeStamp,componentsTimes:Z}}this._acData.push(r),this._options.openReducer?(a(this._options,this._options.cacheEventStorage,JSON.stringify(this._acData)),!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&(this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData())):this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData()},c.prototype.setCustomAc=function(t){var e=t.cusKey;void 0===e&&(e="custom");var o=t.cusVal;void 0===o&&(o=""),this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:o})},c.prototype.postAcData=function(){if(!o(this._acData)&&0!==this._acData.length){var t,e,r,i=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=this._options.imageUrl+"?acError="+i:(void 0===(t={type:"POST",dataType:"json",contentType:"application/json",data:i,url:this._options.postUrl})&&(t={}),t.type=(t.type||"GET").toUpperCase(),t.dataType=t.dataType||"json",t.async=t.async||!0,t.data&&(r=t.data),window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml"):e=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===t.type?(e.open("GET",t.url+"?"+r,t.async),e.send(null)):"POST"===t.type&&(e.open("POST",t.url,t.async),e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r?e.send(r):e.send())),this._acData=[],function(t,e){t.useStorage?window.localStorage.removeItem(e):a(t,e,"",-1)}(this._options,this._options.cacheEventStorage)}},c.prototype.setUserToken=function(t){this._userToken=t},c.install=function(t,e){return function t(e,o,r){t.installed||(t.installed=!0,e.mixin({watch:{$route:function(t,e){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(t,e,!0)}},beforeCreate:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceStart(this),this._uid===this.$root._uid&&this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(null,null,!1)},beforeDestroy:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this._uid===this.$root._uid&&this.$vueDataAc&&this.$vueDataAc.postAcData()},mounted:function(){this.$vueDataAc&&this.$vueDataAc.installed&&(this.$vueDataAc._options.openInput&&(this.$vueDataAc._componentLoadCount++,this.$nextTick((function(){0==--this.$vueDataAc._componentLoadCount&&this.$vueDataAc._mixinInputEvent(this)}))),this.$vueDataAc._options.openComponent&&this.$nextTick((function(){this.$vueDataAc._mixinComponentsPerformanceEnd(this)})))},beforeUpdate:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceStart(this)},updated:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$nextTick((function(){this.$vueDataAc._mixinComponentsPerformanceEnd(this)}))}}),e.prototype.$vueDataAc=new r(o,e))}(t,e,c)},c.version="2.0.8",c},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VueDataAc=e();