/*!
  * vue-dataAc v2.0.0
  * (c) 2020 adminV
  * @license MIT
  */
/*!
  * vue-dataAc v2.0.0
  * (c) 2020 adminV
  * @license MIT
  */
const t={storeVer:"2.0.0",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrData:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,selector:"input",acRange:["text","tel","password"],classTag:"isjs-ac",acbLength:2,imageUrl:"http://open.isjs.cn/logStash/push.png",postUrl:"",openReducer:!1,sizeLimit:20,lifeReport:!1,manualReport:!1};function e(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function r(t){for(let e in t)return!1;return!0}function o(){let t=new Date;return{timeStr:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`,timeStamp:t.getTime()}}class s{constructor(o={},s={}){let i=function(t,e){let r,o={};const s=Object.keys(e);for(let i=0;i<s.length;i++)r=s[i],o[r]=void 0!==t[r]?t[r]:e[r];return o}(o,t);!function(t){if(r(t))return;["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrData","openXhrHock","openPerformance","openPage"].map(r=>{e(t[r])}),t.useImgSend?e(t.imageUrl):e(t.postUrl),t.openInput&&(e(t.selector),e(t.acRange)),t.useStorage}(i),this._options=i,this._vue_=s,this._uuid=function(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);{let t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t&&t.length>1?decodeURIComponent(t[2]):null}}(this._options,this._options.userSha),e(this._uuid)&&(this._uuid=function(t=16,e=16){let r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];for(r=0;r<t;r++)s[r]=o[0|Math.random()*e];return s.join("")}(),function(t,e,r,o){if(t.useStorage)window.localStorage.setItem(e,r);else{o||(o=t.maxDays);let s=new Date;s.setTime(s.getTime()+24*o*60*6e4),document.cookie=`${e}=${encodeURIComponent(r)};expires=${s.toUTCString()};path=/`}}(this._options,this._options.userSha,this._uuid)),this._acData=[],this._lastRouterStr="",this._pageInTime=0,this._init()}_init(){this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openXhrData&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance(),this._options.openInput&&this._initInputAc(),this._options.openClick&&this._initClickAc()}_initPageAc(){}_initXhrErrAc(){}_initPerformance(){}_initCodeErrAc(){window.onerror=(t,r,o,s,i)=>{if(e(r)&&"Script error."===t)return!1;let a={msg:t,line:o,col:s};a.col=s||window.event&&window.event.errorCharacter||0,setTimeout(()=>{if(i&&i.stack)a.err=i.stack.toString();else if(arguments.callee){let t=[],e=arguments.callee.caller,r=3;for(;e&&--r>0&&(t.push(e.toString()),e!==e.caller);)e=e.caller;t=t.join(","),a.err=t}else a.err="script err";this._setAcData(this._options.storeCodeErr,a)},0)}}_initSourceErrAc(){window.addEventListener("error",t=>{if("[object Event]"===[].toString.call(t,t)){let r=t.target||t.srcElement||t.originalTarget||{},{tagName:o,outerHTML:s="",href:i,src:a,currentSrc:n,localName:c}=r;o=o||c;let p=i||a;if("IMG"===o&&!e(r.onerror))return!1;s&&s.length>200&&(s=s.slice(0,200)),this._setAcData(this._options.storeSourceErr,{tagName:o,outerHTML:s,resourceUri:p,currentSrc:n})}})}_initPromiseErrAc(){window.addEventListener("unhandledrejection",t=>{this._setAcData(this._options.storePrmseErr,{reason:t.reason||"unknown"}),t.preventDefault()})}_initInputAc(){}_initClickAc(){}setCustomAc(t){let{cusKey:e="custom",cusVal:r=""}=t;this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:r})}postAcData(){if(e(this._acData)||0===this._acData.length)return;let t=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=`${this._options.imageUrl}?acError=${t}`:function(t={}){let e,r;t.type=(t.type||"GET").toUpperCase(),t.dataType=t.dataType||"json",t.async=t.async||!0,t.data&&(r=t.data),window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):e=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===t.type?(e.open("GET",t.url+"?"+r,t.async),e.send(null)):"POST"===t.type&&(e.open("POST",t.url,t.async),e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r?e.send(r):e.send())}({type:"POST",dataType:"json",contentType:"application/json",data:t,url:this._options.postUrl}),this._acData=[]}_mixinBeforeCreate(){}_mixinMounted(){}_mixinDestroyed(){}_mixinRouterWatch(t={},o={}){let s=t.fullPath||t.path||t.name,i=r(t.params)?t.query:t.params,a=o.fullPath||o.path||o.name,n=r(o.params)?o.query:o.params;this._lastRouterStr!==`${s}-${JSON.stringify(i)}`&&(e(s)||e(a)||(this._lastRouterStr=`${s}-${JSON.stringify(i)}`,this._setAcData(this._options.storePage,{toPath:s,toParams:i,fromPath:a,formParams:n})))}_report(t){}_setAcData(t,e){let r={uuid:this._uuid};switch(t){case this._options.storeInput:break;case this._options.storePage:let{toPath:t,toParams:s,fromPath:i,formParams:a}=e,n=this._pageInTime,c=o().timeStamp;this._pageInTime=c,r.acData={type:this._options.storePage,fromPath:i,formParams:a,toPath:t,toParams:s,sTme:n,eTme:c};break;case this._options.storeClick:case this._options.storeReqErr:break;case this._options.storeCodeErr:let{msg:p,line:u,col:h,err:l}=e;r.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,msg:p,line:u,col:h,err:l};break;case this._options.storeSourceErr:let{tagName:m,outerHTML:_,resourceUri:g,currentSrc:d}=e;r.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,fileName:d,resourceUri:g,tagName:m,outerHTML:_};break;case this._options.storePrmseErr:let{reason:f}=e;r.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,reason:f};break;case this._options.storeCustom:let{cusKey:S,cusVal:C}=e;r.acData={type:this._options.storeCustom,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,cusKey:S,cusVal:C};break;case this._options.storeTiming:}this._acData.push(r),this._options.openReducer?!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&this.postAcData():this.postAcData()}}s.install=(t,e)=>function t(e,r,o){t.installed||(t.installed=!0,e.mixin({watch:{$route(t,e){this.$vueDataAc&&this.$vueDataAc._mixinRouterWatch(t,e)}},beforeCreate(){console.log(this)},destroyed(){},mounted(){}}),e.prototype.$vueDataAc=new o(r,e))}(t,e,s),s.version="2.0.0";export default s;