/*!
  * vue-dataAc v2.0.5
  * (c) 2020 adminV
  * @license MIT
  */
const t={storeVer:"2.0.5",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",storeVueErr:"ACVUERR",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrQuery:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openVueErr:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,maxComponentLoadTime:1e3,openXhrTimeOut:!0,maxRequestTime:1e4,customXhrErrCode:"",selector:"input",ignoreInputType:["password","file"],classTag:"",maxHelpfulCount:5,imageUrl:"http://open.isjs.cn/admin/ac.png",postUrl:"http://open.isjs.cn/logStash/push",openReducer:!1,sizeLimit:20,lifeReport:!1,manualReport:!1};function e(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function o(t){for(const e in t)return!1;return!0}function s(t){const e=t.attributes?t.attributes.length:0,o={};if(e>0)for(let s=0;s<e;s++){const e=t.attributes[s];o[e.nodeName]=e.nodeValue.replace(/"/gim,"'")}return o}function n(t,e,o,s){if(t.useStorage)window.localStorage.setItem(e,o);else{s||(s=t.maxDays);const n=new Date;n.setTime(n.getTime()+24*s*60*6e4),document.cookie=`${e}=${encodeURIComponent(o)};expires=${n.toUTCString()};path=/`}}function i(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);{const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t&&t.length>1?decodeURIComponent(t[2]):null}}function r(){const t=new Date;return{timeStr:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`,timeStamp:t.getTime()}}function a(t,e){const o={},s=Object.keys(e);for(let n=0;n<s.length;n++)o[s[n]]=void 0!==t[s[n]]?t[s[n]]:e[s[n]];return o}function c(t){let s=!0;if(o(t))return!1;if(["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","storeCustom","storeSourceErr","storePrmseErr","storeCompErr","storeVueErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrQuery","openXhrHock","openPerformance","openPage","openVueErr","openSourceErr","openPromiseErr","openComponent","openXhrTimeOut"].map(o=>{e(t[o])&&(s=!1)}),t.useImgSend){if(e(t.imageUrl))return!1}else if(e(t.postUrl))return!1;return(!t.openInput||!e(t.selector))&&((!t.useStorage||void 0!==window.localStorage)&&s)}function p(t){const e=t.toString();let o=t.stack?t.stack.replace(/\n/gi,"").replace(/\bat\b/gi,"@").replace(/\?[^:]+/gi,"").replace(/^\s*|\s*$/g,"").split("@").slice(0,5).join("&&"):"";return o.indexOf(e)<0&&(o=e+"@"+o),o}let u;class m{constructor(o={},s={}){const r=a(o,t);c(r)?(this.installed=!0,this._options=r,this._vue_=s,u=this,this._uuid=i(this._options,this._options.userSha),e(this._uuid)&&(this._uuid=function(t=16,e=16){const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];for(let n=0;n<t;n++)s[n]=o[0|Math.random()*e];return s.join("")}(),n(this._options,this._options.userSha,this._uuid)),this._acData=[],this._proxyXhrObj={},this._inputCacheData={},this._componentsTime={},this._lastRouterStr="",this._userToken="",this._pageInTime=0,this._componentLoadCount=0,this._componentTimeCount=0,this._init()):this.installed=!1}_init(){this._options.openVueErr&&this._initVueErrAc(),this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openClick&&this._initClickAc(),this._options.openXhrQuery&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance()}_mixinInputEvent(t){const{ignoreInputType:e,selector:o}=this._options,s=document.querySelectorAll(o);for(let t=0,o=s.length;t<o;t++){const o=s[t];o.type&&e.indexOf(o.type.toLowerCase())<0&&(o.removeEventListener("input",this._formatInputEvent),o.removeEventListener("blur",this._formatBlurEvent),o.addEventListener("input",this._formatInputEvent),o.addEventListener("blur",this._formatBlurEvent))}}_mixinComponentsPerformanceStart(t){const{$vnode:o={}}=t;e(o.tag)||(t.$_vueAc_bc_time=r().timeStamp,t.$vueDataAc._componentTimeCount++)}_mixinComponentsPerformanceEnd(t){const s=t.$_vueAc_bc_time,{$vnode:n={}}=t,i=n.tag;if(e(s)||e(i))return;const a=r().timeStamp,c=parseInt(a-s);c>=t.$vueDataAc._options.maxComponentLoadTime&&(e(t.$vueDataAc._componentsTime[i])&&(t.$vueDataAc._componentsTime[i]=[]),t.$vueDataAc._componentsTime[i].push(c));0==--t.$vueDataAc._componentTimeCount&&!o(t.$vueDataAc._componentsTime)&&(this._setAcData(t.$vueDataAc._options.storeCompErr,{componentsTimes:t.$vueDataAc._componentsTime}),t.$vueDataAc._componentsTime={})}_formatInputEvent(t){const n=window.event||t,i=n.srcElement?n.srcElement:n.target,{id:a,className:c,value:p,innerText:m}=i,h=s(i),l=p||m,_=r().timeStamp;let d="";try{d=JSON.stringify(h)}catch(t){d=`${a}-${c}`}let f=u._inputCacheData[d];f=e(f)||o(f)?{value:"0:"+l,timeStamp:_}:{value:`${f.value},${parseInt(_-f.timeStamp)}:${l}`,timeStamp:_},u._inputCacheData[d]=f}_formatBlurEvent(t){const o=window.event||t,n=o.srcElement?o.srcElement:o.target,{id:i,className:r}=n,a=s(n);let c="";try{c=JSON.stringify(a)}catch(t){c=`${i}-${r}`}const p=u._inputCacheData[c];e(p)||(u._inputCacheData[c]=null,u._setAcData(u._options.storeInput,{eId:i,className:r,val:p.value,attrs:a}))}_mixinRouterWatch(t={},s={},r){let a="",c={},p="",u={},m="";r?(a=t.fullPath||t.path||t.name,c=o(t.params)?t.query:t.params,p=s.fullPath||s.path||s.name,u=o(s.params)?s.query:s.params,m=this._lastRouterStr):(m=i(this._options,"_vueac_"+this._options.storePage)||"",a=window.location.href,c={search:window.location.search},p=m,u={}),r&&e(a)||e(p)||m!==`${a}-${JSON.stringify(c)}`&&(this._lastRouterStr=`${a}-${JSON.stringify(c)}`,n(this._options,"_vueac_"+this._options.storePage,`${a}-${JSON.stringify(c)}`),this._setAcData(this._options.storePage,{toPath:a,toParams:c,fromPath:p,formParams:u}),!this._options.manualReport&&this._options.lifeReport&&this.postAcData&&this.postAcData())}_initClickAc(){document.addEventListener("click",t=>{const o=window.event||t,n=function t(o,s,n=0){if(Object.prototype.toString.call(o)===Object.prototype.toString.call(document))return null;const i=o&&o.parentNode,{className:r="",id:a}=o,{classTag:c,maxHelpfulCount:p}=s;return e(c)?n>p?null:e(r)&&e(a)?e(i)?null:t(i,s,++n):o:r.indexOf(c)<0?e(i)?null:t(i,s,++n):o}(o.srcElement?o.srcElement:o.target,this._options),{className:i,id:r,value:a,innerText:c}=n,p=s(n);this._setAcData(this._options.storeClick,{eId:r,className:i,val:(a||c).substr(0,20),attrs:p})})}_initXhrErrAc(){const t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send,o=XMLHttpRequest.onreadystatechange;this._proxyXhrObj={open:function(){return this._ac_method=(arguments[0]||[])[0],t&&t.apply(this,arguments)},send:function(){return this._ac_send_time=r().timeStamp,this._ac_post_data=(arguments[0]||[])[0]||"",this.addEventListener("error",(function(t){u._formatXhrErrorData(t.target)})),this.onreadystatechange=function(t){u._formatXhrErrorData(t.target),o&&o.apply(this,arguments)},e&&e.apply(this,arguments)}},XMLHttpRequest.prototype.open=this._proxyXhrObj.open,XMLHttpRequest.prototype.send=this._proxyXhrObj.send}_formatXhrErrorData(t){const o=t,{method:s,send_time:n=0,post_data:i={},readyState:a}=o;if(4===a){const{status:t,statusText:c,response:p,responseURL:m}=o,h=r().timeStamp,l=h-(n||h),{openXhrTimeOut:_,storeReqErr:d,customXhrErrCode:f,openXhrQuery:T}=u._options,v=l>u._options.maxRequestTime,E=!(t>=200&&t<208)&&0!==t&&302!==t,g=!e(f)&&""+(p&&p.code)===f;(_&&v||E||g)&&u._setAcData(d,{responseURL:m,method:s,isHttpErr:E,isCustomErr:g,readyState:a,status:t,statusText:c,requestTime:l,response:(""+p).substr(0,100),query:T?i:""})}}_initPerformance(){if(window.performance){const o=(window.performance||{}).timing;if(!e(o)){var t={WT:o.responseStart-o.navigationStart,TCP:o.connectEnd-o.connectStart,ONL:o.loadEventEnd-o.loadEventStart,ALLRT:o.responseEnd-o.requestStart,TTFB:o.responseStart-o.navigationStart,DNS:o.domainLookupEnd-o.domainLookupStart};this._setAcData(this._options.storeTiming,t)}}}_initVueErrAc(){this._vue_&&this._vue_.config&&(this._vue_.config.errorHandler=(t={},e,o)=>{const s=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name,n=e._isVue&&e.$options&&e.$options.__file?e.$options&&e.$options.__file:"",i=e.$options&&e.$options.propsData;this._setAcData(this._options.storeVueErr,{componentName:s,fileName:n,propsData:i,info:o,msg:t.message||"",stack:p(t)})})}_initCodeErrAc(){window.onerror=(t,o,s,n,i)=>{if(e(o)&&"Script error."===t)return!1;const r={msg:t,line:s,col:n};r.col=n||window.event&&window.event.errorCharacter||0,setTimeout(()=>{if(i&&i.stack)r.err=i.stack.toString();else if(arguments.callee){let t=[],e=arguments.callee.caller,o=3;for(;e&&--o>0&&(t.push(e.toString()),e!==e.caller);)e=e.caller;t=t.join(","),r.err=t}else r.err="script err";this._setAcData(this._options.storeCodeErr,r)},0)}}_initSourceErrAc(){window.addEventListener("error",t=>{if("[object Event]"===[].toString.call(t,t)){const o=t.target||t.srcElement||t.originalTarget||{},{href:s,src:n,currentSrc:i,localName:r}=o,a=o.tagName||r;let c=o.outerHTML;const p=s||n;if("IMG"===a&&!e(o.onerror))return!1;c&&c.length>200&&(c=c.slice(0,200)),this._setAcData(this._options.storeSourceErr,{tagName:a,outerHTML:c,resourceUri:p,currentSrc:i})}})}_initPromiseErrAc(){window.addEventListener("unhandledrejection",t=>{this._setAcData(this._options.storePrmseErr,{reason:t.reason||"unknown"}),t.preventDefault()})}_setAcData(t,e){const o={uuid:this._uuid,t:this._userToken};switch(t){case this._options.storePage:{const{toPath:t,toParams:s,fromPath:n,formParams:i}=e,a=this._pageInTime,c=r().timeStamp;this._pageInTime=c,o.acData={type:this._options.storePage,sTme:c,fromPath:n,formParams:i,toPath:t,toParams:s,inTime:a,outTime:c}}break;case this._options.storeInput:{const{eId:t,className:s,val:n,attrs:i}=e;o.acData={type:this._options.storeInput,path:window.location.href,sTme:r().timeStamp,eId:t,className:s,val:n,attrs:i}}break;case this._options.storeClick:{const{eId:t,className:s,val:n,attrs:i}=e;o.acData={type:this._options.storeClick,path:window.location.href,sTme:r().timeStamp,eId:t,className:s,val:n,attrs:i}}break;case this._options.storeReqErr:{const{responseURL:t,method:s,isHttpErr:n,isCustomErr:i,readyState:a,status:c,statusText:p,requestTime:u,response:m,query:h}=e;o.acData={type:this._options.storeReqErr,path:window.location.href,sTme:r().timeStamp,errSubType:n?"http":i?"custom":"time",responseURL:t,method:s,readyState:a,status:c,statusText:p,requestTime:u,response:m,query:h}}break;case this._options.storeVueErr:{const{componentName:t,fileName:s,propsData:n,info:i,msg:a,stack:c}=e;o.acData={type:this._options.storeVueErr,path:window.location.href,sTme:r().timeStamp,componentName:t,fileName:s,propsData:n,info:i,msg:a,err:c}}break;case this._options.storeCodeErr:{const{msg:t,line:s,col:n,err:i}=e;o.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:r().timeStamp,msg:t,line:s,col:n,err:i}}break;case this._options.storeSourceErr:{const{tagName:t,outerHTML:s,resourceUri:n,currentSrc:i}=e;o.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:r().timeStamp,fileName:i,resourceUri:n,tagName:t,outerHTML:s}}break;case this._options.storePrmseErr:{const{reason:t}=e;o.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:r().timeStamp,reason:t}}break;case this._options.storeCustom:{const{cusKey:t,cusVal:s}=e;o.acData={type:this._options.storeCustom,path:window.location.href,sTme:r().timeStamp,cusKey:t,cusVal:s}}break;case this._options.storeTiming:{const{WT:t,TCP:s,ONL:n,ALLRT:i,TTFB:a,DNS:c}=e;o.acData={type:this._options.storeTiming,path:window.location.href,sTme:r().timeStamp,WT:t,TCP:s,ONL:n,ALLRT:i,TTFB:a,DNS:c}}break;case this._options.storeCompErr:{const{componentsTimes:t}=e;o.acData={type:this._options.storeCompErr,path:window.location.href,sTme:r().timeStamp,componentsTimes:t}}}this._acData.push(o),this._options.openReducer?!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&(this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick(()=>{this.postAcData()}):this.postAcData()):this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick(()=>{this.postAcData()}):this.postAcData()}setCustomAc(t){const{cusKey:e="custom",cusVal:o=""}=t;this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:o})}postAcData(){if(e(this._acData)||0===this._acData.length)return;const t=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=`${this._options.imageUrl}?acError=${t}`:function(t={}){let e,o;t.type=(t.type||"GET").toUpperCase(),t.dataType=t.dataType||"json",t.async=t.async||!0,t.data&&(o=t.data),window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):e=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===t.type?(e.open("GET",t.url+"?"+o,t.async),e.send(null)):"POST"===t.type&&(e.open("POST",t.url,t.async),e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o?e.send(o):e.send())}({type:"POST",dataType:"json",contentType:"application/json",data:t,url:this._options.postUrl}),this._acData=[]}setUserToken(t){this._userToken=t}updateOptions(t){const e=a(t,this._options);c(e)&&(this._options=e)}}m.install=(t,e)=>function t(e,o,s){t.installed||(t.installed=!0,e.mixin({watch:{$route(t,e){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(t,e,!0)}},beforeCreate:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceStart(this),this._uid===this.$root._uid&&this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(null,null,!1)},beforeDestroy(){this.$vueDataAc&&this.$vueDataAc.installed&&this._uid===this.$root._uid&&this.$vueDataAc&&this.$vueDataAc.postAcData()},mounted(){this.$vueDataAc&&this.$vueDataAc.installed&&(this.$vueDataAc._options.openInput&&(this.$vueDataAc._componentLoadCount++,this.$nextTick((function(){0==--this.$vueDataAc._componentLoadCount&&this.$vueDataAc._mixinInputEvent(this)}))),this.$vueDataAc._options.openComponent&&this.$nextTick((function(){this.$vueDataAc._mixinComponentsPerformanceEnd(this)})))},beforeUpdate(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceStart(this)},updated(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$nextTick((function(){this.$vueDataAc._mixinComponentsPerformanceEnd(this)}))}}),e.prototype.$vueDataAc=new s(o,e))}(t,e,m),m.version="2.0.5";export default m;