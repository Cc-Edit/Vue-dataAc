/*!
  * vue-dataAc v2.0.1
  * (c) 2020 adminV
  * @license MIT
  */
/*!
  * vue-dataAc v2.0.1
  * (c) 2020 adminV
  * @license MIT
  */
function t(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function e(t){for(let e in t)return!1;return!0}function o(){let t=new Date;return{timeStr:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`,timeStamp:t.getTime()}}function r(t){const e=t.toString();let o=t.stack.replace(/\n/gi,"").replace(/\bat\b/gi,"@").replace(/\?[^:]+/gi,"").replace(/^\s*|\s*$/g,"").split("@").slice(0,5).join("&&");return o.indexOf(e)<0&&(o=e+"@"+o),o}const s={storeVer:"2.0.1",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",storeVueErr:"ACVUERR",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrData:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openVueErr:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,selector:"input",acRange:["text","tel","password"],classTag:"isjs-ac",acbLength:2,imageUrl:"http://open.isjs.cn/logStash/push.png",postUrl:"",openReducer:!1,sizeLimit:20,lifeReport:!1,manualReport:!1};class i{constructor(o={},r={}){let i=function(t,e){let o,r={};const s=Object.keys(e);for(let i=0;i<s.length;i++)o=s[i],r[o]=void 0!==t[o]?t[o]:e[o];return r}(o,s);!function(o){if(e(o))return;["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrData","openXhrHock","openPerformance","openPage"].map(e=>{t(o[e])}),o.useImgSend?t(o.imageUrl):t(o.postUrl),o.openInput&&(t(o.selector),t(o.acRange)),o.useStorage}(i),this._options=i,this._vue_=r,this._uuid=function(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);{let t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t&&t.length>1?decodeURIComponent(t[2]):null}}(this._options,this._options.userSha),t(this._uuid)&&(this._uuid=function(t=16,e=16){let o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];for(o=0;o<t;o++)s[o]=r[0|Math.random()*e];return s.join("")}(),function(t,e,o,r){if(t.useStorage)window.localStorage.setItem(e,o);else{r||(r=t.maxDays);let s=new Date;s.setTime(s.getTime()+24*r*60*6e4),document.cookie=`${e}=${encodeURIComponent(o)};expires=${s.toUTCString()};path=/`}}(this._options,this._options.userSha,this._uuid)),this._acData=[],this._inputCacheData=[],this._lastRouterStr="",this._pageInTime=0,this._componentCount=0,this._init()}_init(){this._options.openVueErr&&this._initVueErrAc(),this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openClick&&this._initClickAc(),this._options.openXhrData&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance()}_mixinMounted(t){let{acRange:e,selector:o}=this._options;const r=document.querySelector(o);for(let t=0,o=r.length;t<o;t++){let o=r[t];o.type&&e.indexOf(o.type.toLowerCase())>-1&&(o.removeEventListener("input",this._formatInputEvent),o.removeEventListener("blur",this._formatBlurEvent),o.addEventListener("input",this._formatInputEvent),o.addEventListener("blur",this._formatBlurEvent))}}_formatInputEvent(t){console.log(t)}_formatBlurEvent(t){console.log(t)}_mixinRouterWatch(o={},r={}){let s=o.fullPath||o.path||o.name,i=e(o.params)?o.query:o.params,n=r.fullPath||r.path||r.name,a=e(r.params)?r.query:r.params;this._lastRouterStr!==`${s}-${JSON.stringify(i)}`&&(t(s)||t(n)||(this._lastRouterStr=`${s}-${JSON.stringify(i)}`,this._setAcData(this._options.storePage,{toPath:s,toParams:i,fromPath:n,formParams:a})))}_initClickAc(){document.addEventListener("click",(function(t){let e=window.event||t,o=e.srcElement?e.srcElement:e.target;console.log(o)}))}_initXhrErrAc(){}_initPerformance(){}_initVueErrAc(){this._vue_&&this._vue_.config&&(this._vue_.config.errorHandler=(t={},e,o)=>{const s=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name,i=e._isVue&&e.$options&&e.$options.__file?e.$options&&e.$options.__file:"",n=e.$options&&e.$options.propsData;this._setAcData(this._options.storeVueErr,{componentName:s,fileName:i,propsData:n,info:o,msg:t.message||"",stack:r(t)})})}_initCodeErrAc(){window.onerror=(e,o,r,s,i)=>{if(t(o)&&"Script error."===e)return!1;let n={msg:e,line:r,col:s};n.col=s||window.event&&window.event.errorCharacter||0,setTimeout(()=>{if(i&&i.stack)n.err=i.stack.toString();else if(arguments.callee){let t=[],e=arguments.callee.caller,o=3;for(;e&&--o>0&&(t.push(e.toString()),e!==e.caller);)e=e.caller;t=t.join(","),n.err=t}else n.err="script err";this._setAcData(this._options.storeCodeErr,n)},0)}}_initSourceErrAc(){window.addEventListener("error",e=>{if("[object Event]"===[].toString.call(e,e)){let o=e.target||e.srcElement||e.originalTarget||{},{tagName:r,outerHTML:s="",href:i,src:n,currentSrc:a,localName:c}=o;r=r||c;let p=i||n;if("IMG"===r&&!t(o.onerror))return!1;s&&s.length>200&&(s=s.slice(0,200)),this._setAcData(this._options.storeSourceErr,{tagName:r,outerHTML:s,resourceUri:p,currentSrc:a})}})}_initPromiseErrAc(){window.addEventListener("unhandledrejection",t=>{this._setAcData(this._options.storePrmseErr,{reason:t.reason||"unknown"}),t.preventDefault()})}setCustomAc(t){let{cusKey:e="custom",cusVal:o=""}=t;this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:o})}postAcData(){if(t(this._acData)||0===this._acData.length)return;let e=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=`${this._options.imageUrl}?acError=${e}`:function(t={}){let e,o;t.type=(t.type||"GET").toUpperCase(),t.dataType=t.dataType||"json",t.async=t.async||!0,t.data&&(o=t.data),window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):e=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===t.type?(e.open("GET",t.url+"?"+o,t.async),e.send(null)):"POST"===t.type&&(e.open("POST",t.url,t.async),e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o?e.send(o):e.send())}({type:"POST",dataType:"json",contentType:"application/json",data:e,url:this._options.postUrl}),this._acData=[]}_setAcData(t,e){let r={uuid:this._uuid};switch(t){case this._options.storeInput:break;case this._options.storePage:{let{toPath:t,toParams:s,fromPath:i,formParams:n}=e,a=this._pageInTime,c=o().timeStamp;this._pageInTime=c,r.acData={type:this._options.storePage,fromPath:i,formParams:n,toPath:t,toParams:s,sTme:a,eTme:c}}break;case this._options.storeClick:case this._options.storeReqErr:break;case this._options.storeVueErr:{let{componentName:t,fileName:s,propsData:i,info:n,msg:a,stack:c}=e;r.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,componentName:t,fileName:s,propsData:i,info:n,msg:a,err:c}}break;case this._options.storeCodeErr:{let{msg:t,line:s,col:i,err:n}=e;r.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,msg:t,line:s,col:i,err:n}}break;case this._options.storeSourceErr:{let{tagName:t,outerHTML:s,resourceUri:i,currentSrc:n}=e;r.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,fileName:n,resourceUri:i,tagName:t,outerHTML:s}}break;case this._options.storePrmseErr:{let{reason:t}=e;r.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,reason:t}}break;case this._options.storeCustom:{let{cusKey:t,cusVal:s}=e;r.acData={type:this._options.storeCustom,path:window.location.href,sTme:o().timeStamp,ua:navigator.userAgent,cusKey:t,cusVal:s}}break;case this._options.storeTiming:}this._acData.push(r),this._options.openReducer?!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&(this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick(()=>{this.postAcData()}):this.postAcData()):this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick(()=>{this.postAcData()}):this.postAcData()}}i.install=(t,e)=>function t(e,o,r){t.installed||(t.installed=!0,e.mixin({watch:{$route(t,e){this.$vueDataAc&&this.$vueDataAc._mixinRouterWatch(t,e)}},mounted(){this.$vueDataAc._componentCount++,this.$vueDataAc&&this.$vueDataAc._options.openInput&&this.$nextTick((function(){0==--this.$vueDataAc._componentCount&&this.$vueDataAc._mixinMounted(this)}))}}),e.prototype.$vueDataAc=new r(o,e))}(t,e,i),i.version="2.0.1";export default i;