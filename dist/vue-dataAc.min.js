/*!
  * vue-dataAc v2.0.1
  * (c) 2020 adminV
  * @license MIT
  */
/*!
  * vue-dataAc v2.0.1
  * (c) 2020 adminV
  * @license MIT
  */
var t,e;t=this,e=function(){"use strict";function t(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function e(t){for(var e in t)return!1;return!0}function o(t){var e=t.attributes?t.attributes.length:0,o={};if(e>0)for(var r=0;r<e;r++){var a=t.attributes[r];o[a.nodeName]=a.nodeValue.replace(/"/gim,"'")}return o}function r(){var t=new Date;return{timeStr:t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),timeStamp:t.getTime()}}function a(t){var e=t.toString(),o=t.stack.replace(/\n/gi,"").replace(/\bat\b/gi,"@").replace(/\?[^:]+/gi,"").replace(/^\s*|\s*$/g,"").split("@").slice(0,5).join("&&");return o.indexOf(e)<0&&(o=e+"@"+o),o}var n,i={storeVer:"2.0.1",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",storeVueErr:"ACVUERR",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrData:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openVueErr:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,selector:"input",acRange:["text","tel","password"],classTag:"",acbLength:2,imageUrl:"http://open.isjs.cn/admin/ac.png",postUrl:"http://open.isjs.cn/logStash/push",openReducer:!1,sizeLimit:20,lifeReport:!1,manualReport:!1},s=function(o,r){void 0===o&&(o={}),void 0===r&&(r={});var a=function(t,e){for(var o,r={},a=Object.keys(e),n=0;n<a.length;n++)r[o=a[n]]=void 0!==t[o]?t[o]:e[o];return r}(o,i);!function(o){e(o)||(["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrData","openXhrHock","openPerformance","openPage"].map((function(e){t(o[e])})),o.useImgSend?t(o.imageUrl):t(o.postUrl),o.openInput&&(t(o.selector),t(o.acRange)),o.useStorage)}(a),this._options=a,this._vue_=r,n=this,this._uuid=function(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);var o=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return o&&o.length>1?decodeURIComponent(o[2]):null}(this._options,this._options.userSha),t(this._uuid)&&(this._uuid=function(t,e){void 0===t&&(t=16),void 0===e&&(e=16);var o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];for(o=0;o<t;o++)a[o]=r[0|Math.random()*e];return a.join("")}(),function(t,e,o,r){if(t.useStorage)window.localStorage.setItem(e,o);else{r||(r=t.maxDays);var a=new Date;a.setTime(a.getTime()+24*r*60*6e4),document.cookie=e+"="+encodeURIComponent(o)+";expires="+a.toUTCString()+";path=/"}}(this._options,this._options.userSha,this._uuid)),this._acData=[],this._inputCacheData={},this._lastRouterStr="",this._userToken="",this._pageInTime=0,this._componentCount=0,this._init()};return s.prototype._init=function(){this._options.openVueErr&&this._initVueErrAc(),this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openClick&&this._initClickAc(),this._options.openXhrData&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance()},s.prototype._mixinMounted=function(t){for(var e=this._options,o=e.acRange,r=e.selector,a=document.querySelectorAll(r),n=0,i=a.length;n<i;n++){var s=a[n];s.type&&o.indexOf(s.type.toLowerCase())>-1&&(s.removeEventListener("input",this._formatInputEvent),s.removeEventListener("blur",this._formatBlurEvent),s.addEventListener("input",this._formatInputEvent),s.addEventListener("blur",this._formatBlurEvent))}},s.prototype._formatInputEvent=function(a){console.log(1);var i=window.event||a,s=i.srcElement?i.srcElement:i.target,c=s.id,p=s.className,u=s.value,m=s.innerText,h=o(s),l=u||m,_=r().timeStamp,v="";try{v=JSON.stringify(h)}catch(a){v=c+"-"+p}var f=n._inputCacheData[v];f=t(f)||e(f)?{value:"0:"+l,timeStamp:_}:{value:f.value+","+parseInt(_-f.timeStamp)+":"+l,timeStamp:_},n._inputCacheData[v]=f},s.prototype._formatBlurEvent=function(e){var r=window.event||e,a=r.srcElement?r.srcElement:r.target,i=a.id,s=a.className,c=o(a),p="";try{p=JSON.stringify(c)}catch(e){p=i+"-"+s}var u=n._inputCacheData[p];t(u)||(n._inputCacheData[p]=null,n._setAcData(n._options.storeInput,{eId:i,className:s,val:u.value,attrs:c}))},s.prototype._mixinRouterWatch=function(o,r){void 0===o&&(o={}),void 0===r&&(r={});var a=o.fullPath||o.path||o.name,n=e(o.params)?o.query:o.params,i=r.fullPath||r.path||r.name,s=e(r.params)?r.query:r.params;this._lastRouterStr!==a+"-"+JSON.stringify(n)&&(t(a)||t(i)||(this._lastRouterStr=a+"-"+JSON.stringify(n),this._setAcData(this._options.storePage,{toPath:a,toParams:n,fromPath:i,formParams:s})))},s.prototype._initClickAc=function(){var e=this;document.addEventListener("click",(function(r){var a=window.event||r,n=a.srcElement?a.srcElement:a.target,i=n.className,s=n.id,c=n.value,p=n.innerText,u=e._options.classTag;if(t(u)||!(i.indexOf(u)<0)){var m=o(n);e._setAcData(e._options.storeClick,{eId:s,className:i,val:(c||p).substr(0,20),attrs:m})}}))},s.prototype._initXhrErrAc=function(){},s.prototype._initPerformance=function(){},s.prototype._initVueErrAc=function(){var t=this;this._vue_&&this._vue_.config&&(this._vue_.config.errorHandler=function(e,o,r){void 0===e&&(e={});var n=o._isVue?o.$options&&o.$options.name||o.$options&&o.$options._componentTag:o.name,i=o._isVue&&o.$options&&o.$options.__file?o.$options&&o.$options.__file:"",s=o.$options&&o.$options.propsData;t._setAcData(t._options.storeVueErr,{componentName:n,fileName:i,propsData:s,info:r,msg:e.message||"",stack:a(e)})})},s.prototype._initCodeErrAc=function(){var e=arguments,o=this;window.onerror=function(r,a,n,i,s){if(t(a)&&"Script error."===r)return!1;var c={msg:r,line:n,col:i};c.col=i||window.event&&window.event.errorCharacter||0,setTimeout((function(){if(s&&s.stack)c.err=s.stack.toString();else if(e.callee){for(var t=[],r=e.callee.caller,a=3;r&&--a>0&&(t.push(r.toString()),r!==r.caller);)r=r.caller;t=t.join(","),c.err=t}else c.err="script err";o._setAcData(o._options.storeCodeErr,c)}),0)}},s.prototype._initSourceErrAc=function(){var e=this;window.addEventListener("error",(function(o){if("[object Event]"===[].toString.call(o,o)){var r=o.target||o.srcElement||o.originalTarget||{},a=r.tagName,n=r.outerHTML;void 0===n&&(n="");var i=r.href,s=r.src,c=r.currentSrc,p=r.localName,u=i||s;if("IMG"===(a=a||p)&&!t(r.onerror))return!1;n&&n.length>200&&(n=n.slice(0,200)),e._setAcData(e._options.storeSourceErr,{tagName:a,outerHTML:n,resourceUri:u,currentSrc:c})}}))},s.prototype._initPromiseErrAc=function(){var t=this;window.addEventListener("unhandledrejection",(function(e){t._setAcData(t._options.storePrmseErr,{reason:e.reason||"unknown"}),e.preventDefault()}))},s.prototype._setAcData=function(t,e){var o=this,a={uuid:this._uuid,t:this._userToken};switch(t){case this._options.storePage:var n=e.toPath,i=e.toParams,s=e.fromPath,c=e.formParams,p=this._pageInTime,u=r().timeStamp;this._pageInTime=u,a.acData={type:this._options.storePage,fromPath:s,formParams:c,toPath:n,toParams:i,sTme:p,eTme:u};break;case this._options.storeInput:var m=e.eId,h=e.className,l=e.val,_=e.attrs;a.acData={type:this._options.storeInput,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,eId:m,className:h,val:l,attrs:_};break;case this._options.storeClick:var v=e.eId,f=e.className,d=e.val,g=e.attrs;a.acData={type:this._options.storeClick,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,eId:v,className:f,val:d,attrs:g};break;case this._options.storeReqErr:break;case this._options.storeVueErr:var E=e.componentName,y=e.fileName,S=e.propsData,C=e.info,T=e.msg,A=e.stack;a.acData={type:this._options.storeVueErr,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,componentName:E,fileName:y,propsData:S,info:C,msg:T,err:A};break;case this._options.storeCodeErr:var D=e.msg,w=e.line,P=e.col,k=e.err;a.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,msg:D,line:w,col:P,err:k};break;case this._options.storeSourceErr:var I=e.tagName,R=e.outerHTML,N=e.resourceUri,x=e.currentSrc;a.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,fileName:x,resourceUri:N,tagName:I,outerHTML:R};break;case this._options.storePrmseErr:var $=e.reason;a.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,reason:$};break;case this._options.storeCustom:var b=e.cusKey,L=e.cusVal;a.acData={type:this._options.storeCustom,path:window.location.href,sTme:r().timeStamp,ua:navigator.userAgent,cusKey:b,cusVal:L};break;case this._options.storeTiming:}this._acData.push(a),this._options.openReducer?!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&(this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData()):this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData()},s.prototype.setCustomAc=function(t){var e=t.cusKey;void 0===e&&(e="custom");var o=t.cusVal;void 0===o&&(o=""),this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:o})},s.prototype.postAcData=function(){if(!t(this._acData)&&0!==this._acData.length){var e,o,r,a=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=this._options.imageUrl+"?acError="+a:(void 0===(e={type:"POST",dataType:"json",contentType:"application/json",data:a,url:this._options.postUrl})&&(e={}),e.type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=e.async||!0,e.data&&(r=e.data),window.XMLHttpRequest?(o=new XMLHttpRequest).overrideMimeType&&o.overrideMimeType("text/xml"):o=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===e.type?(o.open("GET",e.url+"?"+r,e.async),o.send(null)):"POST"===e.type&&(o.open("POST",e.url,e.async),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r?o.send(r):o.send())),this._acData=[]}},s.prototype.setUserToken=function(t){this._userToken=t},s.install=function(t,e){return function t(e,o,r){t.installed||(t.installed=!0,e.mixin({watch:{$route:function(t,e){this.$vueDataAc&&this.$vueDataAc._mixinRouterWatch(t,e)}},mounted:function(){this.$vueDataAc._componentCount++,this.$vueDataAc&&this.$vueDataAc._options.openInput&&this.$nextTick((function(){0==--this.$vueDataAc._componentCount&&this.$vueDataAc._mixinMounted(this)}))}}),e.prototype.$vueDataAc=new r(o,e))}(t,e,s)},s.version="2.0.1",s},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VueDataAc=e();