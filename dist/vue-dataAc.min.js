/*!
  * vue-dataAc v2.0.5
  * (c) 2020 adminV
  * @license MIT
  */
var t,e;t=this,e=function(){"use strict";function t(t){return!(0===t&&"0"===t||void 0!==t&&null!=t&&"null"!==t&&""!==t)}function e(t){for(var e in t)return!1;return!0}function o(t){var e=t.attributes?t.attributes.length:0,o={};if(e>0)for(var r=0;r<e;r++){var i=t.attributes[r];o[i.nodeName]=i.nodeValue.replace(/"/gim,"'")}return o}function r(t,e){if(!e)return null;if(t.useStorage)return window.localStorage.getItem(e);var o=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return o&&o.length>1?decodeURIComponent(o[2]):null}function i(){var t=new Date;return{timeStr:t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),timeStamp:t.getTime()}}function n(t,e){for(var o={},r=Object.keys(e),i=0;i<r.length;i++)o[r[i]]=void 0!==t[r[i]]?t[r[i]]:e[r[i]];return o}function a(o){var r=!0;if(e(o))return!1;if(["storeInput","storePage","storeClick","storeReqErr","storeTiming","storeCodeErr","storeCustom","storeSourceErr","storePrmseErr","storeCompErr","storeVueErr","userSha","useImgSend","useStorage","maxDays","openInput","openCodeErr","openClick","openXhrQuery","openXhrHock","openPerformance","openPage","openVueErr","openSourceErr","openPromiseErr","openComponent","openXhrTimeOut"].map((function(e){t(o[e])&&(r=!1)})),o.useImgSend){if(t(o.imageUrl))return!1}else if(t(o.postUrl))return!1;return(!o.openInput||!t(o.selector))&&(!o.useStorage||void 0!==window.localStorage)&&r}function s(t){var e=t.toString(),o=t.stack.replace(/\n/gi,"").replace(/\bat\b/gi,"@").replace(/\?[^:]+/gi,"").replace(/^\s*|\s*$/g,"").split("@").slice(0,5).join("&&");return o.indexOf(e)<0&&(o=e+"@"+o),o}var p,c={storeVer:"2.0.5",storeInput:"ACINPUT",storePage:"ACPAGE",storeClick:"ACCLIK",storeReqErr:"ACRERR",storeTiming:"ACTIME",storeCodeErr:"ACCERR",storeCustom:"ACCUSTOM",storeSourceErr:"ACSCERR",storePrmseErr:"ACPRERR",storeCompErr:"ACCOMP",storeVueErr:"ACVUERR",userSha:"vue_ac_userSha",useImgSend:!0,useStorage:!0,maxDays:365,openInput:!0,openCodeErr:!0,openClick:!0,openXhrQuery:!0,openXhrHock:!0,openPerformance:!0,openPage:!0,openVueErr:!0,openSourceErr:!0,openPromiseErr:!0,openComponent:!0,maxComponentLoadTime:1e3,openXhrTimeOut:!0,maxRequestTime:1e4,customXhrErrCode:"",selector:"input",ignoreInputType:["password","file"],classTag:"",imageUrl:"http://open.isjs.cn/admin/ac.png",postUrl:"http://open.isjs.cn/logStash/push",openReducer:!1,sizeLimit:20,lifeReport:!1,manualReport:!1},u=function(e,o){void 0===e&&(e={}),void 0===o&&(o={});var i=n(e,c);a(i)?(this.installed=!0,this._options=i,this._vue_=o,p=this,this._uuid=r(this._options,this._options.userSha),t(this._uuid)&&(this._uuid=function(t,e){void 0===t&&(t=16),void 0===e&&(e=16);for(var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[],i=0;i<t;i++)r[i]=o[0|Math.random()*e];return r.join("")}(),function(t,e,o,r){if(t.useStorage)window.localStorage.setItem(e,o);else{r||(r=t.maxDays);var i=new Date;i.setTime(i.getTime()+24*r*60*6e4),document.cookie=e+"="+encodeURIComponent(o)+";expires="+i.toUTCString()+";path=/"}}(this._options,this._options.userSha,this._uuid)),this._acData=[],this._proxyXhrObj={},this._inputCacheData={},this._componentsTime={},this._lastRouterStr="",this._userToken="",this._pageInTime=0,this._componentLoadCount=0,this._componentTimeCount=0,this._init()):this.installed=!1};return u.prototype._init=function(){this._options.openVueErr&&this._initVueErrAc(),this._options.openCodeErr&&this._initCodeErrAc(),this._options.openSourceErr&&this._initSourceErrAc(),this._options.openPromiseErr&&this._initPromiseErrAc(),this._options.openClick&&this._initClickAc(),this._options.openXhrQuery&&this._initXhrErrAc(),this._options.openPerformance&&this._initPerformance()},u.prototype._mixinInputEvent=function(t){for(var e=this._options,o=e.ignoreInputType,r=e.selector,i=document.querySelectorAll(r),n=0,a=i.length;n<a;n++){var s=i[n];s.type&&o.indexOf(s.type.toLowerCase())<0&&(s.removeEventListener("input",this._formatInputEvent),s.removeEventListener("blur",this._formatBlurEvent),s.addEventListener("input",this._formatInputEvent),s.addEventListener("blur",this._formatBlurEvent))}},u.prototype._mixinComponentsPerformanceStart=function(e){var o=e.$vnode;void 0===o&&(o={}),t(o.tag)||(e.$_vueAc_bc_time=i().timeStamp,e.$vueDataAc._componentTimeCount++)},u.prototype._mixinComponentsPerformanceEnd=function(e){var o=e.$_vueAc_bc_time,r=e.$vnode;void 0===r&&(r={});var n=r.tag;if(!t(o)&&!t(n)){var a=i().timeStamp,s=parseInt(a-o);if(!(s<e.$vueDataAc._options.maxComponentLoadTime)){var p=0==--e.$vueDataAc._componentTimeCount,c=e.$vueDataAc._componentsTime,u=c[n]||[];u.push(s),c[n]=u,p?(e.$vueDataAc._componentsTime={},this._setAcData(e.$vueDataAc._options.storeCompErr,{componentsTimes:c})):e.$vueDataAc._componentsTime=c}}},u.prototype._formatInputEvent=function(r){var n=window.event||r,a=n.srcElement?n.srcElement:n.target,s=a.id,c=a.className,u=a.value,m=a.innerText,h=o(a),_=u||m,l=i().timeStamp,d="";try{d=JSON.stringify(h)}catch(r){d=s+"-"+c}var v=p._inputCacheData[d];v=t(v)||e(v)?{value:"0:"+_,timeStamp:l}:{value:v.value+","+parseInt(l-v.timeStamp)+":"+_,timeStamp:l},p._inputCacheData[d]=v},u.prototype._formatBlurEvent=function(e){var r=window.event||e,i=r.srcElement?r.srcElement:r.target,n=i.id,a=i.className,s=o(i),c="";try{c=JSON.stringify(s)}catch(e){c=n+"-"+a}var u=p._inputCacheData[c];t(u)||(p._inputCacheData[c]=null,p._setAcData(p._options.storeInput,{eId:n,className:a,val:u.value,attrs:s}))},u.prototype._mixinRouterWatch=function(o,i,n){void 0===o&&(o={}),void 0===i&&(i={});var a="",s={},p="",c={},u="";n?(a=o.fullPath||o.path||o.name,s=e(o.params)?o.query:o.params,p=i.fullPath||i.path||i.name,c=e(i.params)?i.query:i.params,u=this._lastRouterStr):(u=r(this._options,"_vueac_"+this._options.storePage)||"",a=window.location.href,s={search:window.location.search},p=u,c={}),u!==a+"-"+JSON.stringify(s)&&(t(a)||(this._lastRouterStr=a+"-"+JSON.stringify(s),this._setAcData(this._options.storePage,{toPath:a,toParams:s,fromPath:p,formParams:c}),!this._options.manualReport&&this._options.lifeReport&&this.postAcData&&this.postAcData()))},u.prototype._initClickAc=function(){var e=this;document.addEventListener("click",(function(r){var i=window.event||r,n=i.srcElement?i.srcElement:i.target,a=n.className,s=n.id,p=n.value,c=n.innerText,u=e._options.classTag;if(t(u)||!(a.indexOf(u)<0)){var m=o(n);e._setAcData(e._options.storeClick,{eId:s,className:a,val:(p||c).substr(0,20),attrs:m})}}))},u.prototype._initXhrErrAc=function(){var t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send,o=XMLHttpRequest.onreadystatechange;this._proxyXhrObj={open:function(){return this._ac_method=(arguments[0]||[])[0],t&&t.apply(this,arguments)},send:function(){return this._ac_send_time=i().timeStamp,this._ac_post_data=(arguments[0]||[])[0]||"",this.addEventListener("error",(function(t){p._formatXhrErrorData(t.target)})),this.onreadystatechange=function(t){p._formatXhrErrorData(t.target),o&&o.apply(this,arguments)},e&&e.apply(this,arguments)}},XMLHttpRequest.prototype.open=this._proxyXhrObj.open,XMLHttpRequest.prototype.send=this._proxyXhrObj.send},u.prototype._formatXhrErrorData=function(e){var o=e,r=o.method,n=o.send_time;void 0===n&&(n=0);var a=o.post_data;void 0===a&&(a={});var s=o.readyState;if(4===s){var c=o.status,u=o.statusText,m=o.response,h=o.responseURL,_=i().timeStamp,l=_-(n||_),d=p._options,v=d.openXhrTimeOut,f=d.storeReqErr,T=d.customXhrErrCode,E=d.openXhrQuery,g=l>p._options.maxRequestTime,y=!(c>=200&&c<208)&&0!==c&&302!==c,D=!t(T)&&""+(m&&m.code)===T;(v&&g||y||D)&&p._setAcData(f,{responseURL:h,method:r,isHttpErr:y,isCustomErr:D,readyState:s,status:c,statusText:u,requestTime:l,response:(""+m).substr(0,100),query:E?a:""})}},u.prototype._initPerformance=function(){if(window.performance){var e=(window.performance||{}).timing;if(!t(e)){var o={WT:e.responseStart-e.navigationStart,TCP:e.connectEnd-e.connectStart,ONL:e.loadEventEnd-e.loadEventStart,ALLRT:e.responseEnd-e.requestStart,TTFB:e.responseStart-e.navigationStart,DNS:e.domainLookupEnd-e.domainLookupStart};this._setAcData(this._options.storeTiming,o)}}},u.prototype._initVueErrAc=function(){var t=this;this._vue_&&this._vue_.config&&(this._vue_.config.errorHandler=function(e,o,r){void 0===e&&(e={});var i=o._isVue?o.$options&&o.$options.name||o.$options&&o.$options._componentTag:o.name,n=o._isVue&&o.$options&&o.$options.__file?o.$options&&o.$options.__file:"",a=o.$options&&o.$options.propsData;t._setAcData(t._options.storeVueErr,{componentName:i,fileName:n,propsData:a,info:r,msg:e.message||"",stack:s(e)})})},u.prototype._initCodeErrAc=function(){var e=arguments,o=this;window.onerror=function(r,i,n,a,s){if(t(i)&&"Script error."===r)return!1;var p={msg:r,line:n,col:a};p.col=a||window.event&&window.event.errorCharacter||0,setTimeout((function(){if(s&&s.stack)p.err=s.stack.toString();else if(e.callee){for(var t=[],r=e.callee.caller,i=3;r&&--i>0&&(t.push(r.toString()),r!==r.caller);)r=r.caller;t=t.join(","),p.err=t}else p.err="script err";o._setAcData(o._options.storeCodeErr,p)}),0)}},u.prototype._initSourceErrAc=function(){var e=this;window.addEventListener("error",(function(o){if("[object Event]"===[].toString.call(o,o)){var r=o.target||o.srcElement||o.originalTarget||{},i=r.href,n=r.src,a=r.currentSrc,s=r.localName,p=r.tagName||s,c=r.outerHTML,u=i||n;if("IMG"===p&&!t(r.onerror))return!1;c&&c.length>200&&(c=c.slice(0,200)),e._setAcData(e._options.storeSourceErr,{tagName:p,outerHTML:c,resourceUri:u,currentSrc:a})}}))},u.prototype._initPromiseErrAc=function(){var t=this;window.addEventListener("unhandledrejection",(function(e){t._setAcData(t._options.storePrmseErr,{reason:e.reason||"unknown"}),e.preventDefault()}))},u.prototype._setAcData=function(t,e){var o=this,r={uuid:this._uuid,t:this._userToken};switch(t){case this._options.storePage:var n=e.toPath,a=e.toParams,s=e.fromPath,p=e.formParams,c=this._pageInTime,u=i().timeStamp;this._pageInTime=u,r.acData={type:this._options.storePage,sTme:u,fromPath:s,formParams:p,toPath:n,toParams:a,inTime:c,outTime:u};break;case this._options.storeInput:var m=e.eId,h=e.className,_=e.val,l=e.attrs;r.acData={type:this._options.storeInput,path:window.location.href,sTme:i().timeStamp,eId:m,className:h,val:_,attrs:l};break;case this._options.storeClick:var d=e.eId,v=e.className,f=e.val,T=e.attrs;r.acData={type:this._options.storeClick,path:window.location.href,sTme:i().timeStamp,eId:d,className:v,val:f,attrs:T};break;case this._options.storeReqErr:var E=e.responseURL,g=e.method,y=e.isHttpErr,D=e.isCustomErr,S=e.readyState,A=e.status,C=e.statusText,w=e.requestTime,$=e.response,P=e.query;r.acData={type:this._options.storeReqErr,path:window.location.href,sTme:i().timeStamp,errSubType:y?"http":D?"custom":"time",responseURL:E,method:g,readyState:S,status:A,statusText:C,requestTime:w,response:$,query:P};break;case this._options.storeVueErr:var R=e.componentName,L=e.fileName,k=e.propsData,x=e.info,I=e.msg,N=e.stack;r.acData={type:this._options.storeVueErr,path:window.location.href,sTme:i().timeStamp,componentName:R,fileName:L,propsData:k,info:x,msg:I,err:N};break;case this._options.storeCodeErr:var b=e.msg,X=e.line,O=e.col,q=e.err;r.acData={type:this._options.storeCodeErr,path:window.location.href,sTme:i().timeStamp,msg:b,line:X,col:O,err:q};break;case this._options.storeSourceErr:var M=e.tagName,U=e.outerHTML,V=e.resourceUri,H=e.currentSrc;r.acData={type:this._options.storeSourceErr,path:window.location.href,sTme:i().timeStamp,fileName:H,resourceUri:V,tagName:M,outerHTML:U};break;case this._options.storePrmseErr:var j=e.reason;r.acData={type:this._options.storePrmseErr,path:window.location.href,sTme:i().timeStamp,reason:j};break;case this._options.storeCustom:var B=e.cusKey,W=e.cusVal;r.acData={type:this._options.storeCustom,path:window.location.href,sTme:i().timeStamp,cusKey:B,cusVal:W};break;case this._options.storeTiming:var F=e.WT,G=e.TCP,J=e.ONL,K=e.ALLRT,Q=e.TTFB,z=e.DNS;r.acData={type:this._options.storeTiming,path:window.location.href,sTme:i().timeStamp,WT:F,TCP:G,ONL:J,ALLRT:K,TTFB:Q,DNS:z};break;case this._options.storeCompErr:var Y=e.componentsTimes;r.acData={type:this._options.storeCompErr,path:window.location.href,sTme:i().timeStamp,componentsTimes:Y}}this._acData.push(r),this._options.openReducer?!this._options.manualReport&&this._options.sizeLimit&&this._acData.length>=this._options.sizeLimit&&(this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData()):this._vue_&&this._vue_.$nextTick?this._vue_.$nextTick((function(){o.postAcData()})):this.postAcData()},u.prototype.setCustomAc=function(t){var e=t.cusKey;void 0===e&&(e="custom");var o=t.cusVal;void 0===o&&(o=""),this._setAcData(this._options.storeCustom,{cusKey:e,cusVal:o})},u.prototype.postAcData=function(){if(!t(this._acData)&&0!==this._acData.length){var e,o,r,i=JSON.stringify(this._acData);this._options.useImgSend?(new Image).src=this._options.imageUrl+"?acError="+i:(void 0===(e={type:"POST",dataType:"json",contentType:"application/json",data:i,url:this._options.postUrl})&&(e={}),e.type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=e.async||!0,e.data&&(r=e.data),window.XMLHttpRequest?(o=new XMLHttpRequest).overrideMimeType&&o.overrideMimeType("text/xml"):o=new ActiveXObject("Microsoft.XMLHTTP"),"GET"===e.type?(o.open("GET",e.url+"?"+r,e.async),o.send(null)):"POST"===e.type&&(o.open("POST",e.url,e.async),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r?o.send(r):o.send())),this._acData=[]}},u.prototype.setUserToken=function(t){this._userToken=t},u.prototype.updateOptions=function(t){var e=n(t,this._options);a(e)&&(this._options=e)},u.install=function(e,o){return function e(o,r,i){e.installed||(e.installed=!0,o.mixin({watch:{$route:function(t,e){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(t,e,!0)}},beforeCreate:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceStart(this),this._uid===this.$root._uid&&t(this.$router)&&this.$vueDataAc&&this.$vueDataAc.installed&&this.$vueDataAc._options.openPage&&this.$vueDataAc._mixinRouterWatch(null,null,!1)},beforeDestroy:function(){this.$vueDataAc&&this.$vueDataAc.installed&&this._uid===this.$root._uid&&this.$vueDataAc&&this.$vueDataAc.postAcData()},mounted:function(){this.$vueDataAc&&this.$vueDataAc.installed&&(this.$vueDataAc._options.openInput&&(this.$vueDataAc._componentLoadCount++,this.$nextTick((function(){0==--this.$vueDataAc._componentLoadCount&&this.$vueDataAc._mixinInputEvent(this)}))),this.$vueDataAc._options.openComponent&&this.$vueDataAc._mixinComponentsPerformanceEnd(this))}}),o.prototype.$vueDataAc=new i(r,o))}(e,o,u)},u.version="2.0.5",u},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VueDataAc=e();